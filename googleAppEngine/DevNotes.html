<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>开发手记</title>
		<meta http-equiv="content-type" content="text/html; charset=GBK" />   
		<link type="text/css" rel="stylesheet" href="stylesheets/main.css" />
		<link type="text/css" rel="stylesheet" href="stylesheets/chengming.css" />
    </head>
	<body>
		<p><a href="/">首页</a>|<a href="/guestbook">guest book</a>|<a href="/zhugechengming/cheng">诸葛亮称命法</a>|<a href="/DevNotes.html">开发手记</a></p>
		<h1>开发手记</h1>
		<p>经过四天的研究，google app engine 上的第一个小东西终于可以正常运行了，虽然页面布局丑了些，都是自己做的，css 现学现卖。
			首页是 http://gui-cn.appspot.com/，除了google提供的例子，自己写的功能是一个小小的算命程序，<a href="zhugechengming/cheng">诸葛亮称命法</a>，内容也是抄的。</p>
		<p>这个应用可以成为一个完整的静态页面托管服务，作为一个自己的静态空间来使用，每天10G的免费流量够了，算是找到一个高质量的免费空间。主要的app.yaml配置代码是：
			<div class="code">
				application: gui-cn <br />
				version: 3 <br />
				runtime: python <br />
				api_version: 1 <br />
				 <br />
				handlers: <br />
				- url: /(.*\.html) <br />
				  static_files: \1 <br />
				  upload: .*\.html <br />
				  <br />
				- url: / <br />
				  static_files: index.html <br />
				  upload: index.html <br />
				 <br />
				- url: /stylesheets <br />
				  static_dir: stylesheets <br />
				 <br />
				- url: /images <br />
				  static_dir: images <br />
				  <br />
				- url: /javascripts <br />
				  static_dir: javascripts <br />
				 <br />
				- url: /.* <br />
				  script: myApp.py <br />
		</div>
			另外，四点注意事项留下来备忘：
			<ol>
				<li>用google提供的web模板框架的话，模板文件不能是静态文件，比如在我的设置中，所有的html文件都处理为静态文件，模板就不能用html作为后缀，我改成了.template，否则在开发环境正常运行，上传上去后就抱文件找不到的错误。</li>
				<li>还有一个是作为python初学者犯的错误，一个目录要python认为是package的话，要有__init__.py文件，我一开始没有，import语句出错找了很久才找到原因。</li>
				<li>http response缺省编码是utf-8，改为gbk的语句是:<div class="code">self.response.headers['Content-Type'] = 'text/html;charset=GBK'</div></li>
                <li>在内网通过代理，appcfg.py上传出错，即使设置http_proxy和https_proxy，因为 python 有Bug。 here is how to apply the patch:
                    <ol>
                        <li>Download patch http://bugs.python.org/file9753/http-tunnel-urllib</li>
                        <li>Open it (it is just a text file). For instance, rename it to http-tunnel-urllib.txt and open it with Wordpad.</li>
                        <li>Let's say you installed Python in $PYTHON. So, edit $PYTHON/Lib/urllib2.py</li>
                        <li>Remove/insert the lines as described with the -/+ signs in the first part of the patch. There are tools to do this automatically, but there are very few changes to perform here, so it is quickly done.</li>
                        <li>Do the same with httplib.py</li>
                        <li>That's it. Now try to upload your app as usual.</li>
                    </ol>
                </li>
			</ol>
		<p id="footer">Power by Google App Engine. CopyRight 2008 - 2010，杨贵堂。</p>
	</body>
</html>